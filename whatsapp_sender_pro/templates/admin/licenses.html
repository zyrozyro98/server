<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ - WhatsApp Sender Pro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2c3e50;
        }
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .sidebar {
            background: var(--secondary);
            color: white;
            height: 100vh;
            position: fixed;
            width: 250px;
            padding-top: 20px;
        }
        .main-content {
            margin-right: 250px;
            padding: 20px;
        }
        .table th {
            background: var(--secondary);
            color: white;
        }
        .badge-active { background: #27ae60; }
        .badge-expired { background: #e74c3c; }
        .badge-suspended { background: #f39c12; }
    </style>
</head>
<body>
    <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
    <div class="sidebar">
        <div class="text-center mb-4">
            <h4>ğŸ“± WhatsApp Sender Pro</h4>
            <small>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</small>
        </div>

        <nav class="nav flex-column">
            <a class="nav-link" href="{{ url_for('admin.dashboard') }}">
                <i class="bi bi-speedometer2 me-2"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            </a>
            <a class="nav-link active" href="{{ url_for('admin.licenses') }}">
                <i class="bi bi-key me-2"></i> Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ
            </a>
            <a class="nav-link" href="{{ url_for('admin.users') }}">
                <i class="bi bi-people me-2"></i> Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            </a>
            <a class="nav-link" href="{{ url_for('admin.payments') }}">
                <i class="bi bi-credit-card me-2"></i> Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª
            </a>
            <a class="nav-link" href="{{ url_for('admin.activity') }}">
                <i class="bi bi-clock-history me-2"></i> Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·
            </a>
            <hr>
            <a class="nav-link" href="{{ url_for('admin.logout') }}">
                <i class="bi bi-box-arrow-right me-2"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
            </a>
        </nav>
    </div>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div class="main-content">
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2><i class="bi bi-key me-2"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ</h2>
            <div>
                <a href="{{ url_for('admin.create_license') }}" class="btn btn-primary">
                    <i class="bi bi-plus-circle me-2"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø®ØµØ© Ø¬Ø¯ÙŠØ¯Ø©
                </a>
            </div>
        </div>

        <!-- ÙÙ„ØªØ±Ø© Ø§Ù„Ø¨Ø­Ø« -->
        <div class="card mb-4">
            <div class="card-body">
                <form method="GET" class="row g-3">
                    <div class="col-md-4">
                        <input type="text" class="form-control" name="search" placeholder="ğŸ” Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ..." value="{{ search }}">
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" name="status">
                            <option value="all" {% if status_filter == 'all' %}selected{% endif %}>ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                            <option value="active" {% if status_filter == 'active' %}selected{% endif %}>Ù†Ø´Ø·Ø©</option>
                            <option value="expired" {% if status_filter == 'expired' %}selected{% endif %}>Ù…Ù†ØªÙ‡ÙŠØ©</option>
                            <option value="suspended" {% if status_filter == 'suspended' %}selected{% endif %}>Ù…ÙˆÙ‚ÙˆÙØ©</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <button type="submit" class="btn btn-primary w-100">Ø¨Ø­Ø«</button>
                    </div>
                    <div class="col-md-2">
                        <a href="{{ url_for('admin.licenses') }}" class="btn btn-secondary w-100">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</a>
                    </div>
                </form>
            </div>
        </div>

        <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ -->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Ù…ÙØªØ§Ø­ Ø§Ù„Ø±Ø®ØµØ©</th>
                                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                <th>Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for license in licenses %}
                            <tr>
                                <td>
                                    <code>{{ license.license_key }}</code>
                                    <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyToClipboard('{{ license.license_key }}')">
                                        <i class="bi bi-copy"></i>
                                    </button>
                                </td>
                                <td>
                                    <span class="badge bg-{{ 'success' if license.plan_type == 'premium' else 'info' if license.plan_type == 'standard' else 'warning' }}">
                                        {{ license.plan_type }}
                                    </span>
                                </td>
                                <td>
                                    {% if license.status == 'active' %}
                                        <span class="badge badge-active">Ù†Ø´Ø·Ø©</span>
                                    {% elif license.status == 'expired' %}
                                        <span class="badge badge-expired">Ù…Ù†ØªÙ‡ÙŠØ©</span>
                                    {% elif license.status == 'suspended' %}
                                        <span class="badge badge-suspended">Ù…ÙˆÙ‚ÙˆÙØ©</span>
                                    {% else %}
                                        <span class="badge bg-secondary">{{ license.status }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if license.email %}
                                        {{ license.email }}<br>
                                        <small class="text-muted">{{ license.name or '' }}</small>
                                    {% else %}
                                        <span class="text-muted">ØºÙŠØ± Ù…Ø±ØªØ¨Ø·</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {{ license.device_count }}/{{ license.max_devices }}
                                </td>
                                <td>{{ license.created_at.strftime('%Y-%m-%d') }}</td>
                                <td>
                                    {% if license.expiry_date %}
                                        {{ license.expiry_date.strftime('%Y-%m-%d') }}
                                        {% set days_left = (license.expiry_date - now).days %}
                                        {% if days_left <= 7 and days_left > 0 %}
                                            <br><small class="text-warning">({{ days_left }} ÙŠÙˆÙ…)</small>
                                        {% elif days_left <= 0 %}
                                            <br><small class="text-danger">(Ù…Ù†ØªÙ‡ÙŠØ©)</small>
                                        {% endif %}
                                    {% else %}
                                        <span class="text-muted">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="btn-group btn-group-sm">
                                        <a href="{{ url_for('admin.edit_license', license_key=license.license_key) }}"
                                           class="btn btn-outline-primary">
                                            <i class="bi bi-pencil"></i>
                                        </a>
                                        <a href="{{ url_for('admin.delete_license', license_key=license.license_key) }}"
                                           class="btn btn-outline-danger"
                                           onclick="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø®ØµØ©ØŸ')">
                                            <i class="bi bi-trash"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- Ø§Ù„ØªØ±Ù‚ÙŠÙ… -->
                {% if total_pages > 1 %}
                <nav aria-label="Page navigation">
                    <ul class="pagination justify-content-center">
                        {% for page in range(1, total_pages + 1) %}
                        <li class="page-item {% if page == current_page %}active{% endif %}">
                            <a class="page-link" href="?page={{ page }}&search={{ search }}&status={{ status_filter }}">
                                {{ page }}
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                </nav>
                {% endif %}
            </div>
        </div>
    </div>

    <script>
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function() {
                alert('ØªÙ… Ù†Ø³Ø® Ù…ÙØªØ§Ø­ Ø§Ù„Ø±Ø®ØµØ©: ' + text);
            }, function(err) {
                console.error('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®: ', err);
            });
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>